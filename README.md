# A scuffed dumpster fire i didnt bother to finish
### This will work only on linux
#### also you are ***encouraged*** to fork and continue this project to be less of a scuffed dumpster fire

# Required commands on your system:
- `timeout` - for scuffed reading of pipes where i would `timeout 0.05s cat <pipe>`
- `ps` - for scuffed finding of pid from the command

How to use:
1) install qemu
2) give this mod trusted
3) create a test virtual machine in the virtual_machines folder, and name it test because that's exactly what's hardcoded in example_frontend.lua
- `qemu-img create -f qcow2 test.img`
- `mkfifo test.in test.out`
- `mkfifo test_monitor.in test_monitor.out`
4) install arch linux on it ***without!!*** a GUI or anything of that sort
5) add console=ttyS0 to the command line
6) Look in the source code if you need to disable kvm or add more ram/cores
7) actually boot up minetest with this mod enabled


Things that desperately need to get fixed:
- Add foreground color, optionally background color, there's a system already in the works but yeah it doesnt work and thats exactly when i gave up
- allow the user to output some of the qemu monitor commands
- test the code (like a decent amount)
- test the key combinations, most of them were generated by ai (i couldnt bother) and most of them probably dont work
- Somehow figure out how to rely less on hacks like `timeout 0.05s cat <pipe>` and `ps -C <command>`
- The massive amounts of debug logging needs to go away

# Security
Probably terrible please don't put this on a server

# Reliability
if your server shuts down the wrong way you might have a vm process still running im pretty sure

also if the stars don't align during shutdown, some `ps -C` command might fail horribly and hang minetest

# Potential
- maybe theres *some*

# Api docs

## the QemuVirtMachine class
### Stuff global to all QemuVirtMachines:
- `QemuVirtMachine.new(vm_name, cpu_arch, cdrom)`
  - vm_name: the name of the... vm.... as seen obviously in the virtual_machines folder, example: `"test"`
  - cpu_arch: the cpu architecture, your computer is *most likely* x86_64
  - cdrom: a file from the boot_images folder, example:
    - `"/archlinux.iso"` would point to `boot_images/archlinux.iso`
    - as for why you need to include the "/"... well yeah i got lazy and just didnt finish this
- `QemuVirtMachine.new_raw(info)` - allows way lower control (such as specifying the exact command), please see the source code ^w^
- `QemuVirtMachine.machines` - an array of QemuVirtMachines, used to shut them down at shutdown
- `QemuVirtMachine.vm_path` `QemuVirtMachine.boot_image_path` - yeah
- `QemuVirtMachine.create_vm(name, size)` - creates a virtual machine, same process as in the instructions (so pipes n crap)
#### Ok now for the actual methods of the class
- `QemuVirtMachine:stop()` - stops the machine, dont use more than once
- `QemuVirtMachine:send_input(input)` - sends the input to the vm
- `QemuVirtMachine:send_command(command)` - sends the command to the qemu monitor pipe - UNSURE IF THIS WORKS BUT PROBABLY NOT.
- `QemuVirtMachine:get_output()` - gets the output
- `QemuVirtMachine.dead` - if its stopped
- some things were left undocumented, check the sourcecode of the new_raw function for details

# Ok now the other stuff, some may call this "polluting the global environment" i call it... actually the same thing

`function ansi2formspec(raw_text, position, bell)`
- raw_text: your text...
- position: just a table with: `{ x =, y =, w =, h =, label_spacing = }`, all in formspec coordinates
- bell: the function for the bell, the escape code thats supposed to make a sound (have fun with this)
- returns: a formspec inside a scroll container
- does not work very good, can easily crash the game, has 400 lines of very mostly untested bad code
- starts to hit engine limitations because spacing the labels correctly automatically is ***not possible*** AAAAAAAAAAAAAAAAAA

`function key_combination_processor(input_str)`
- input_str: the string, keys seperated by `-`
- returns a string
- in the format of `ctrl-c`

# Good luck!